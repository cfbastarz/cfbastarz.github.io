---
layout: post
title: Derivaçao da Equação de Análise a partir da Função Custo Variacional Tridimensional
date: 2013-11-14 13:46:46.000000000 -02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Ciência
- Tudo
tags:
- 3DVar
- Assimilação de Dados
- Equação de Análise
- Função Custo Variacional
meta:
  _edit_last: '13386696'
  _publicize_pending: '1'
  _post_restored_from: a:3:{s:20:"restored_revision_id";i:2186;s:16:"restored_by_user";i:13386696;s:13:"restored_time";i:1396139991;}
author:
  login: craftmind
  email: cfbastarz@gmail.com
  display_name: cfbastarz
  first_name: ''
  last_name: ''
permalink: "/2013/11/14/derivacao-da-equacao-de-analise-a-partir-da-funcao-custo-variacional-tridimensional/"
---
<p>Abaixo apresento uma derivação da equação de análise utilizada em assimilação de dados para a determinação da condição inicial dos modelos de previsão numérica de tempo. Esta equação é obtida a partir da função custo variacional tridimensional (3DVar), sem considerar a dimensão temporal das observações. Logo, todos os elementos do vetor observação $latex \mathbf{y^{o}}$ são considerados em um mesmo $latex t=t_{0}$, enquanto que o background $latex \mathbf{x_{b}}$ é considerado no tempo $latex t=t_{0}-1$ e a análise $latex \mathbf{x_{a}}$ é obtida para o mesmo tempo das observações ($latex t=t_{0}$).</p>
<p>Apesar de parecer um tanto quanto enfadonho (principalmente porque este é um passo a passo), acho interessante apresentar as idéias relacionadas à derivação porque não se tem textos semelhantes em português. Para um texto científico, a maioria das passagens abaixo seriam descartadas, reduzindo esta derivação a poucas equações. De antemão, acrescento que sugestões e correções são bem vindas, visto que algumas imprecisões podem existir.</p>
<p>Seja (1) a função custo variacional tridimensional:</p>
<p align="center">$latex J(\mathbf{x}) = \frac{1}{2}(\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + \frac{1}{2}(\mathbf{y^o} - \textit{H}(\mathbf{x}))^{T}\mathbf{R}^{-1}(\mathbf{y^o} - \textit{H}(\mathbf{x}))$<br />
(1)</p>
<p><strong>Onde:</strong></p>
<ul>
<li>$latex \mathbf{x}$ é o vetor de estado a ser analisado de dimensão $latex \textit{p}$</li>
<li>$latex \mathbf{x_{b}}$ é o vetor de estado do background de dimensão $latex \textit{p}$</li>
<li>$latex \mathbf{B}$ é a matriz de covariâncias dos erros de background de dimensão $latex \textit{p}\times\textit{p}$</li>
<li>$latex \mathbf{y^{o}}$ é o vetor observação de dimensão $latex \textit{n}$</li>
<li>$latex \mathbf{R}$ é a matriz de covariâncias dos erros de observação de dimensão $latex \textit{n}\times\textit{n}$</li>
<li>$latex \textit{H}$ é o operador observação não linear</li>
</ul>
<p><b>Oservação:</b> Em geral $latex \textit{H}$ é um modelo linearizado (portanto sob a forma $latex \mathbf{H}$) que mapeia os valores do background para os pontos em que estão as observações.</p>
<p>Na Eq. (1), o termo $latex (\mathbf{x} - \mathbf{x_{b}})$ representa o vetor incremento de análise e o termo $latex (\mathbf{y^{o}} - \textit{H}(\mathbf{x}))$ representa o vetor inovação.</p>
<p>Para derivar a equação de análise a partir de (1), consideramos (por simplicidade) apenas uma observação e que o vetor incremento de análise é pequeno o suficiente para que possamos linearizar o operador observação:</p>
<p align="center">$latex \mathbf{x} = \mathbf{x_{b}} + (\mathbf{x} - \mathbf{x_{b}})$<br />
(2)</p>
<p>Ou seja, em (2) expressamos que o vetor de estado a ser analisado (a análise) é igual ao vetor de estado do background somado ao incremento de análise. Substituindo $latex \mathbf{x}$ da Eq. (2) na relação do vetor inovação:</p>
<p align="center">$latex \mathbf{y^{o}} - \textit{H}(\mathbf{x}) = \mathbf{y^{o}} - \textit{H}[\mathbf{x_{b}} + (\mathbf{x} - \mathbf{x_{b}})]$<br />
(3)</p>
<p align="center">$latex \mathbf{y^{o}} - \textit{H}(\mathbf{x}) = \mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \textit{H}(\mathbf{x} - \mathbf{x_{b}})$<br />
(4)</p>
<p>Na Eq. (4) o operador observação não linear $latex \textit{H}$ é aplicado sobre o incremento de análise $latex (\mathbf{x} - \mathbf{x_{b}})$, o qual é muito pequeno. Sendo assim, considera-se que o operador observação a ser aplicado sobre o incremento de análise pode ser linearizado. Isto significa que pequenas variações do vetor incremento de análise fazem com que $latex \textit{H}$ varie muito pouco. Portanto, a Eq. (4) pode ser reescrita como:</p>
<p align="center">$latex \mathbf{y^{o}} - \textit{H}(\mathbf{x}) = \mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})$<br />
(5)</p>
<p><strong>Onde:</strong></p>
<ul>
<li>$latex \mathbf{H}$ é a versão linearizada do operador observação não linear ($latex \textit{H}$).</li>
</ul>
<p>Substituindo a Eq. (5) na Eq. (1):</p>
<p align="center">$latex J(\mathbf{x}) = \frac{1}{2}(\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + \frac{1}{2}[\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]^{T}\mathbf{R}^{-1}[\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]$<br />
(6)</p>
<p>Fatorando e desenvolvendo a Eq. (6):</p>
<p align="center">$latex J(\mathbf{x}) = \frac{1}{2}\lbrace(\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + [\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]^{T}\mathbf{R}^{-1}[\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]\rbrace $<br />
(7)</p>
<p align="center">$latex 2J(\mathbf{x}) = (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + [\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]^{T}\mathbf{R}^{-1}[\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]$<br />
(8)</p>
<p align="center">$latex 2J(\mathbf{x}) = (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + [(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T} - (\mathbf{H}(\mathbf{x} - \mathbf{x_{b}}))^{T}]\mathbf{R}^{-1}[\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]$<br />
(9)</p>
<p align="center">$latex 2J(\mathbf{x}) = (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + [(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T} - \mathbf{H}^{T}(\mathbf{x} - \mathbf{x_{b}})^{T}]\mathbf{R}^{-1}[\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]$<br />
(10)</p>
<p align="center">$latex 2J(\mathbf{x}) = (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + [(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1} - \mathbf{H}^{T}(\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{R}^{-1}][\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}) - \mathbf{H}(\mathbf{x} - \mathbf{x_{b}})]$<br />
(11)</p>
<p align="center">$latex 2J(\mathbf{x}) = (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + (\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}})) - (\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}\mathbf{H}(\mathbf{x} - \mathbf{x_{b}}) - \mathbf{H}^{T}(\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}})) + \mathbf{H}^{T}(\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{R}^{-1}\mathbf{H}(\mathbf{x} - \mathbf{x_{b}})$<br />
(12)</p>
<p>Reorganizando a Eq. (12) - aqui serão fatorados os termos 1 e 5 do lado direito:</p>
<p align="center">$latex 2J(\mathbf{x}) = (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{B}^{-1}(\mathbf{x} - \mathbf{x_{b}}) + (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H}(\mathbf{x} - \mathbf{x_{b}}) - (\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}\mathbf{H}(\mathbf{x} - \mathbf{x_{b}}) - (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{H}^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}})) + (\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))$<br />
(13)</p>
<p>Combinando os dois primeiros termos do lado direito de (13), obtemos:</p>
<p align="center">$latex 2J(\mathbf{x}) = (\mathbf{x} - \mathbf{x_{b}})^{T}[\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H}](\mathbf{x} - \mathbf{x_{b}}) - (\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}\mathbf{H}(\mathbf{x} - \mathbf{x_{b}}) - (\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{H}^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}})) + (\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))$<br />
(14)</p>
<p>A forma da Eq. (14) é a forma em que será aplicado o operador gradiente. O gradiente é aplicado na função custo variacional para se determinar o vetor de estado de análise $latex \mathbf{x_{a}}$ tal que $latex \nabla_{x}{J(\mathbf{x})} = 0$. Ou seja, o mínimo de $latex J(\mathbf{x})$ fornece os valores do vetor de estado analisado.</p>
<p><b>Teorema (1):</b><br />
Dada a função quadrática $latex F(\mathbf{x}) = \frac{1}{2}\mathbf{x}^{T}\mathbf{A}\mathbf{x} + \mathbf{d} + c$, onde $latex \mathbf{A}$ é uma matriz simétrica (ou seja, é igual à sua transposta), $latex \mathbf{x}$ e $latex \mathbf{d}$ são vetores e $latex c$ é um escalar, o gradiente de $latex F(\mathbf{x})$ é dado por $latex \nabla_{x}{F(\mathbf{x})} = \mathbf{A}\mathbf{x} + \mathbf{d}$.</p>
<p><b>Demonstração (1):</b></p>
<p align="center">$latex F(\mathbf{x}) = \frac{1}{2}\mathbf{x}^{T}\mathbf{A}\mathbf{x} + \mathbf{d} + c \\<br />
\frac{\partial F}{\partial x} = \frac{1}{2}(\mathbf{A}\mathbf{x} + \mathbf{A}^{T}\mathbf{x}) + \mathbf{d}$<br />
(15)</p>
<p>Se $latex \mathbf{A}$ é simétrica, então $latex \mathbf{A}^{T} = \mathbf{A}$, logo:</p>
<p align="center">$latex \frac{\partial F}{\partial x} = \frac{1}{2}(\mathbf{A}\mathbf{x} + \mathbf{A}\mathbf{x}) + \mathbf{d} \\<br />
\frac{\partial F}{\partial x} = \frac{1}{2}(2\mathbf{A}\mathbf{x}) + \mathbf{d} \\<br />
\frac{\partial F}{\partial x} = \mathbf{A}\mathbf{x} + \mathbf{d}$<br />
(16)</p>
<p>Aplicando o operador gradiente na Eq. (14), obtem-se:</p>
<p align="center">$latex \nabla_{x}{2J(\mathbf{x})} = \frac{\partial \lbrace(\mathbf{x} - \mathbf{x_{b}})^{T}[\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H}](\mathbf{x} - \mathbf{x_{b}})\rbrace}{\partial x} - \frac{\partial \lbrace(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}\mathbf{H}(\mathbf{x} - \mathbf{x_{b}})\rbrace}{\partial x} - \frac{\partial \lbrace(\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{H}^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))\rbrace}{\partial x} + \frac{\partial \lbrace(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))\rbrace}{\partial x}$<br />
(17)</p>
<p>Na Eq. (17) observamos que o termo 4 do lado direito não depende do vetor de estado analisado $latex \mathbf{x}$ e que portanto $latex \frac{\partial \lbrace(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))\rbrace}{\partial x} = 0$, logo:</p>
<p align="center">$latex 2\nabla_{x}{J(\mathbf{x})} = \frac{\partial \lbrace(\mathbf{x} - \mathbf{x_{b}})^{T}[\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H}](\mathbf{x} - \mathbf{x_{b}})\rbrace}{\partial x} - \frac{\partial \lbrace(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}\mathbf{H}(\mathbf{x} - \mathbf{x_{b}})\rbrace}{\partial x} - \frac{\partial \lbrace(\mathbf{x} - \mathbf{x_{b}})^{T}\mathbf{H}^{T}\mathbf{R}^{-1}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))\rbrace}{\partial x}$<br />
(18)</p>
<p>Utilizando o Teorema (1), obtem-se:</p>
<p align="center">$latex 2\nabla_{x}{J(\mathbf{x})} = [(\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})^{T}(\mathbf{x} - \mathbf{x_{b}}) + (\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})(\mathbf{x} - \mathbf{x_{b}})] - \frac{\partial \lbrace(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))^{T}\mathbf{R}^{-1}\mathbf{H}(\mathbf{x} - \mathbf{x_{b}})\rbrace}{\partial x} - [(\mathbf{H}^{T}\mathbf{R}^{-1})^{T}(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}})) + (\mathbf{H}^{T}\mathbf{R}^{-1})(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))]$<br />
(19)</p>
<p>O segundo termo da Eq. (19) resulta em zero, pois a derivada da constante $latex (\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))\mathbf{R}^{-1}\mathbf{H}$ é zero.</p>
<p>Utilizando-se do fato de que as relações entre as matrizes nos termos 1-3 do lado direito da Eq. (18) geram matrizes simétricas (e.g., $latex (\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})^{T}= (\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})$), a Eq. (19) reduz-se a:</p>
<p align="center">$latex 2\nabla_{x}{J(\mathbf{x})} = 2[(\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})(\mathbf{x} - \mathbf{x_{b}})] - 2[(\mathbf{H}^{T}\mathbf{R}^{-1})(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))]$<br />
(20)</p>
<p>e,</p>
<p align="center">$latex \nabla_{x}{J(\mathbf{x})} = (\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})(\mathbf{x} - \mathbf{x_{b}}) - (\mathbf{H}^{T}\mathbf{R}^{-1})(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))$<br />
(21)</p>
<p>No inicio foi feita consideração de que o vetor de estados analisado $latex \mathbf{x}$ é a própria análise quando $latex \nabla_{x}{J(\mathbf{x})} = 0$, logo iguala-se a Eq. (21) a zero, de forma que $latex \mathbf{x} = \mathbf{x_{a}}$:</p>
<p align="center">$latex 0 = (\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})(\mathbf{x_{a}} - \mathbf{x_{b}}) - (\mathbf{H}^{T}\mathbf{R}^{-1})(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))$<br />
(22)</p>
<p>Reorganizando a Eq. (22):</p>
<p align="center">$latex (\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})(\mathbf{x_{a}} - \mathbf{x_{b}}) - (\mathbf{H}^{T}\mathbf{R}^{-1})(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}})) = 0 \\<br />
(\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})(\mathbf{x_{a}} - \mathbf{x_{b}}) = (\mathbf{H}^{T}\mathbf{R}^{-1})(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}})) \\<br />
(\mathbf{x_{a}} - \mathbf{x_{b}}) = (\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})^{-1}[(\mathbf{H}^{T}\mathbf{R}^{-1})(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))]$<br />
(23)</p>
<p>A partir da Eq. (23), obtemos a Equação de Análise:</p>
<p align="center">$latex \mathbf{x_{a}} = \mathbf{x_{b}} + (\mathbf{B}^{-1} + \mathbf{H}^{T}\mathbf{R}^{-1}\mathbf{H})^{-1}[(\mathbf{H}^{T}\mathbf{R}^{-1})(\mathbf{y^{o}} - \textit{H}(\mathbf{x_{b}}))]$<br />
(24)</p>
