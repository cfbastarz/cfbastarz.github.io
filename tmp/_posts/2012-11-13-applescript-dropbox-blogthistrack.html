---
layout: post
title: AppleScript + Dropbox = BlogThisTrack!
date: 2012-11-13 20:11:37.000000000 -02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Internet
- Tudo
- Tutoriais
tags:
- AppleScript
- dropbox
- iTunes
- Mac OS X
meta:
  _publicize_pending: '1'
  _edit_last: '13386696'
  _oembed_2a3959bf322b9e040afda9d36cea6684: "{{unknown}}"
  _oembed_2ee904893ab305ff7c25a4da186dd68d: "{{unknown}}"
  _oembed_2c3e1ed6e723e3d0daa174658fbb82d4: "{{unknown}}"
  _oembed_3646ebceb8aa06d311dc851f4c1589ae: "{{unknown}}"
  _oembed_15db76a0f2e32b47a4814cc024e2eda7: "{{unknown}}"
  _oembed_01861c48eddd6cb32bbbb98a0abc6752: "{{unknown}}"
  _oembed_1d00ed5746ccc3003977dcef9f8f0751: "{{unknown}}"
  _oembed_673dea72095da5d01724af84b8826917: "{{unknown}}"
  _oembed_643a99fb7c8c7a850fc514cb60cd7c21: "{{unknown}}"
  _oembed_0b83e215254689e35d7a72ddcd574560: "{{unknown}}"
  _oembed_0da95c075d76aa6554516d3dedfea08d: "{{unknown}}"
  _oembed_a9e54d51d95e539520c39d03fa75e459: "{{unknown}}"
  _oembed_55ff3e1dd5ca00626cfa1b28ae511c5a: "{{unknown}}"
  _oembed_58825ab0999511f816b2793181682819: "{{unknown}}"
  _oembed_743e06a2934a250f35c2e6346635bd2a: "{{unknown}}"
  _oembed_2f759c5bc5435aec6e9e8bb30201f26a: "{{unknown}}"
  _oembed_c045891306822b57e5206cf27402f2c8: "{{unknown}}"
  _oembed_858b7e3612b306e6c93e8b5f061d1b98: "{{unknown}}"
  _oembed_89b9dabf859adbb22a3de659e6a19864: "{{unknown}}"
  _oembed_b964d3fe4ea403b20a78a8a19dabf6ae: "{{unknown}}"
  _oembed_be2b84a95a0899eddefbc700d9bc3ce6: "{{unknown}}"
  _oembed_ea8be7ea04ef5f7d71745051d8dedb7b: "{{unknown}}"
  _oembed_7cbe848e63c73b2915289558f26917d4: "{{unknown}}"
  _oembed_5c9350b5f687f1886ec1e5ad4c807dc4: "{{unknown}}"
  _oembed_28ca25ab6ccc222f0e255060b5304a33: "{{unknown}}"
author:
  login: craftmind
  email: cfbastarz@gmail.com
  display_name: cfbastarz
  first_name: ''
  last_name: ''
permalink: "/2012/11/13/applescript-dropbox-blogthistrack/"
---
<p>Rá!</p>
<p>Eu sempre quis colocar em meu blog os livros que leio, os discos que escuto e as coisas que gosto. Fazer uma resenha sobre um disco ou livro, é praxe e mandatório, mas como mostrar - em tempo real - o que estou escutando?</p>
<p>Sabendo das possibilidades e da linguagem AppleScript, como por exemplo, controlar o iTunes e outros programas através da linha de comando, decidi que colocaria na sidebar do meu blog, uma área com a capa do disco que eu estivesse escutando no iTunes. E é bem simples!</p>
<p>Vamos aos ingredientes:</p>
<ul>
<li>Você vai precisar do Dropbox;</li>
<li>E do iTunes (a princípio é necessário estar no Mac OS X para executar o script).</li>
</ul>
<p>A ideia é a seguinte: utilizar um link público do dropbox para disponibilizar uma imagem (a capa do album) no seu site/blog. O AppleScript vai servir para recuperar a capa do Album da música que está sendo tocada no iTunes e colocá-la em um pasta pública do Dropbox; o Dropbox, por sua vez, fornece um link público que será colocado no site. Mas como manter o mesmo link se a imagem é atualizada sempre que uma novo Album estiver tocando? Simples: o link (url) aponta para um link simbólico na pasta pública do Dropbox! Nada como uma bela gambiarra :)</p>
<p>O código AppleScript utilizado para recuperar a capa do Album que está tocando no iTunes e copiar para a pasta pública no Dropbox, segue mais abaixo e você deve colocá-lo em:</p>
<pre>/Users/$USER/Library/iTunes/Scripts</pre>
<p>Se esta pasta não existir, basta criá-la:</p>
<pre>$ mkdir -p /Users/$USER/Library/iTunes/Scripts</pre>
<p>Feito isto, copie o ApplScript "BlogThisTrack" (download mais abaixo) para a pasta:</p>
<pre>$ cp BlogThisTrack.scpt /Users/$USER/Library/iTunes/Scripts</pre>
<p>Para fazer tudo funcionar, execute uma vez o AppleScript e, na pasta BlogThisTrack (dentro da pasta pública do Dropbox), crie um link simbólico da imagem do Album recuperada com um nome qualquer, por exemplo:</p>
<pre>$ cd ~$USER/Dropbox/Public/BlogThisTrack
$ ln -s iTunes.png albumart.png</pre>
<p>Observe que o link "albumart.png" será atualizado sempre que o script AppleScript for executado.</p>
<p>[caption id="attachment_1886" align="aligncenter" width="305"]<a href="http://craftmind.wordpress.com/2012/11/13/applescript-dropbox-blogthistrack/screen-shot-2012-11-13-at-7-18-01-pm/" rel="attachment wp-att-1886"><img class="size-full wp-image-1886" title="Screen Shot 2012-11-13 at 7.18.01 PM" alt="" src="{{ site.baseurl }}/assets/screen-shot-2012-11-13-at-7-18-01-pm.png" width="305" height="141" /></a> Exemplo dos arquivos que ficam dentro da pasta BlogThisTrack, dentro da pasta pública do Dropbpox. Observe que o arquivo albumart.png é um link simbólico para o arquivo de imagem iTunes.png.[/caption]</p>
<p>Agora uma parte importante, o link: quando se coloca arquivos dentro da pasta Public do Dropbox, é possível obter um link público para qualquer arquivo. Para fazer isto, pelo Finder, dê um clique de "dois dedos" (clique sobre o arquivo utilizando dois dedos, assim você terá acesso ao menu de contexto do Finder) sobre o arquivo, aponte para o menu do Dropbox e selecione a opção "Copy Public Link":</p>
<p>[caption id="attachment_1895" align="aligncenter" width="522"]<a href="http://craftmind.wordpress.com/2012/11/13/applescript-dropbox-blogthistrack/screen-shot-2012-11-13-at-8-09-44-pm/" rel="attachment wp-att-1895"><img class="size-full wp-image-1895" title="Screen Shot 2012-11-13 at 8.09.44 PM" alt="" src="{{ site.baseurl }}/assets/screen-shot-2012-11-13-at-8-09-44-pm.png" width="522" height="193" /></a> Obtendo o link público que será usado para linkar a imagem no seu site/blog.[/caption]</p>
<p>Feito isto, no site, escolha algum lugar (como uma barra lateral) em que será colocada a capa do Album. Na área escolhida, coloque o código:</p>
<pre>&lt;img src="https://link.que.o.dropbox.criou/albumart.png" /&gt;</pre>
<p>Sinta-se livre para incrementar, adicionando uma borda ou mesmo limitando o tamanho da imagem - assim todas as capas poderão ter o mesmo tamanho ;)</p>
<p>Se você estiver no wordpress, e caso você não tenha acesso ao código-fonte do seu site/blog, a melhor forma de fazer a inserção desse código - e é aí que a coisa fica esperta!, é usar a widget de texto.</p>
<p>[caption id="attachment_1884" align="aligncenter" width="447"]<a href="http://craftmind.wordpress.com/2012/11/13/applescript-dropbox-blogthistrack/screen-shot-2012-11-13-at-7-14-16-pm/" rel="attachment wp-att-1884"><img class="size-full wp-image-1884" title="Screen Shot 2012-11-13 at 7.14.16 PM" alt="" src="{{ site.baseurl }}/assets/screen-shot-2012-11-13-at-7-14-16-pm.png" width="447" height="440" /></a> Insira uma widget de texto na área que você quiser e insira o código acima.[/caption]</p>
<p>Insira uma widget de texto na área que você quiser e insira o código acima.</p>
<p>Agora, sempre que você quiser mostrar que Album está escutando no iTunes, basta executar o AppleScript que a capa do Album será atualizada no seu site/blog!</p>
<p>[caption id="attachment_1887" align="aligncenter" width="576"]<a href="http://craftmind.wordpress.com/2012/11/13/applescript-dropbox-blogthistrack/screen-shot-2012-11-13-at-7-08-29-pm/" rel="attachment wp-att-1887"><img class="size-full wp-image-1887" title="Screen Shot 2012-11-13 at 7.08.29 PM" alt="" src="{{ site.baseurl }}/assets/screen-shot-2012-11-13-at-7-08-29-pm.png" width="576" height="255" /></a> Executando o AppleScript BlogThisTrack dentro do iTunes.[/caption]</p>
<p>E e resultado (no seu site/blog):</p>
<p>[caption id="attachment_1903" align="aligncenter" width="277"]<a href="http://craftmind.wordpress.com/2012/11/13/applescript-dropbox-blogthistrack/screen-shot-2012-11-13-at-7-13-39-pm/" rel="attachment wp-att-1903"><img class="size-full wp-image-1903" title="Screen Shot 2012-11-13 at 7.13.39 PM" alt="" src="{{ site.baseurl }}/assets/screen-shot-2012-11-13-at-7-13-39-pm.png" width="277" height="364" /></a> Capa do Album no site/blog![/caption]</p>
<p><strong>AppleScript</strong></p>
<p>Para utilizar este código, não copie este abaixo, mas utilize o link de download a seguir.</p>
<pre>--BlogThisTrack - script para recuperar a capa de um Album tocando 
  no iTunes e escrever em um arquivo
--AppleScript original em 
  http://www.macosxtips.co.uk/geeklets/collections/
  itunes-seperate-info-mail-infos-/
--Créditos para http://www.macosxtips.co.uk 
  (usuário 
  http://www.macosxtips.co.uk/geeklets/user/profile/csoul/) 
  e craftmind.wordpress.com (usuário 
  http://craftmind.wordpress.com/about/)
--Linguagem: AppleScript (compilador v.2.2.3)
--Data: 13/11/2012

--A variável "myPath" define onde se encontra a pasta 
  "BlogThisTrack" (para o script funcionar, ela deve ser criada 
  manualmete):
<b>set</b> myPath <b>to</b> ((<b>path to</b> home folder) <b>as</b> <i>text</i>) &amp; 
  "Dropbox:Public:BlogThisTrack:"
--A variável "artworkItunes" define o caminho absoluto para 
  o arquivo "iTunes.png" que será escrito ao final do script:
<b>set</b> artworkItunes <b>to</b> POSIX path <b>of</b> myPath &amp; "iTunes.png"
--A variável "defaultPic" define um arquivo intermediário
<b>set</b> defaultPic <b>to</b> POSIX path <b>of</b> myPath &amp; "default.png"

<b>if</b> running <b>of</b> <i>application</i> "iTunes" <b>then</b>
    --Na estrutura abaixo, literalmente é dito ao programa 
      iTunes executar as seguintes ações:
<b>    tell</b> <i>application</i> "iTunes"
        --Define-se a variável "artData" para receber a 
          informação da capa do Album da música que está sendo 
          executada no iTunes:
<b>        set</b> artData <b>to</b> data <b>of</b> <i>artwork</i> 1 <b>of</b> current track
        --Define-se a variável "fileRef" que irá abrir atribuir
          à variável "artworkiTunes" (que aponta para o arquivo
          alvo iTunes.png) a informação da capa do Album:
<b>        set</b> fileRef <b>to</b> (<b>open for access</b> artworkItunes <b>with</b> 
        write permission)
        --Utiliza-se o método try:
        --Caso o iTunes esteja tocando alguma música e esta
          possui uma capa de Album definida, a informação da 
          capa do Album será escrita na variável "fileRef":
<b>        try</b>
<b>            write</b> artData to fileRef starting at 0
<b>            close access</b> fileRef
            --Caso alguma música não esteja tocando ou se
              não houver capa de Album disponível, uma mensagem
              de erro padrão será mostrada:
<b>            on</b> <b>error</b> errorMsg
            --Novamente usa-se o método try, agora para fechar 
              o arquivo iTunes.png:
<b>            try</b>
<b>                close access</b> fileRef
<b>            end</b> <b>try</b>
            --Caso algum erro de escrita ocorra (devida a um disco 
              cheio, por exemplo):
<b>            error</b> errorMsg
<b>        end</b> <b>try</b>
<b>    end</b> <b>tell</b>
<b>else</b>
    --Utiliza-se o programa Image Events (pode-se utilizá-lo 
      em outros scripts para a manipulação de imagens):
<b>    tell</b> <i>application</i> "Image Events"
<b>        set</b> defaultData <b>to</b> <b>open</b> defaultPic
        --Salva o arquivo final na variável principal 
          "artworkiTunes":
<b>        save</b> defaultData as PNG in artworkItunes <b>with</b> replace
        --Fecha o arquivo final:
<b>        close</b> defaultData
<b>    end</b> <b>tell</b>
<b>end</b> <b>if
</b></pre>
<p><strong>Download</strong></p>
<p>Aqui: <a href="https://dl.dropbox.com/u/1029421/BlogThisTrack/BlogThisTrack-v0.1.scpt" target="_blank">BlogThisTrack</a>!</p>
<p><strong>Dicas</strong></p>
<ul>
<li>Como o "BlogThisTrack" utiliza o iTunes, tire proveito disso: utilize-o para manter as capas dos seus Albuns atualizadas, assim não correrá o risco de não ter nenhuma imagem para mostrar;</li>
<li>Há outros AppleScripts que podem ser utilizados para ajudar a manter a sua biblioteca de músicas organizada e atualizada, veja <a href="http://dougscripts.com/itunes/" target="_blank">aqui</a>.</li>
</ul>
<p><strong>Observações</strong></p>
<ul>
<li>Este método depende do Dropbox. Para que a atualização das capas do Album no seu site/blog funcione, é necessário que o Dropbox esteja funcionando.</li>
</ul>
<p><strong>Referências</strong></p>
<ul>
<li><a href="http://www.macosxtips.co.uk/geeklets/collections/itunes-seperate-info-mail-infos-/" target="_blank">http://www.macosxtips.co.uk/geeklets/collections/itunes-seperate-info-mail-infos-/</a></li>
</ul>
