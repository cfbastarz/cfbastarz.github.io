---
layout: post
title: Backup local simples com o rsync
date: 2012-09-24 11:34:26.000000000 -03:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Tudo
- Tutoriais
tags:
- backup
- ksh
- rsync
- script
- Shell
meta:
  _edit_last: '13386696'
author:
  login: craftmind
  email: cfbastarz@gmail.com
  display_name: cfbastarz
  first_name: ''
  last_name: ''
permalink: "/2012/09/24/backup-local-simples-com-o-rsync/"
---
<p>O script abaixo tem por objetivo realizar o backup/sincronização (incremental) entre duas pastas diferentes, facilitando e agilizando p processo de cópia de grandes volumes de arquivos.</p>
<p><strong>Algorítmo</strong></p>
<p>O algorítmo deste script segue os seguintes passos:</p>
<ol>
<li>Verificação dos argumentos de entrada:
<ol>
<li>Verifica se a quantidade de argumentos não é dois (caso postivo, mostra a função ajuda e finaliza);</li>
<li>Verifica se a quantidade de argumentos é dois (caso positivo, verifica os locais - se são acessíveis ou não);</li>
</ol>
</li>
<li>Com os dois argumentos de entrada (origem e destino, respectivamente), chama a função backup</li>
<li>Finaliza o script</li>
</ol>
<pre>#!/bin/ksh
#set -o xtrace
ajuda() {
print "Uso: ./backup_rsync.ksh &lt;origem&gt; &lt;destino&gt;"
 exit 1
}
backup() {
origem=${1}
 destino=${2}
rsync -av ${origem}/ ${destino}/
}
if [ $# -ne 2 ]
 then
ajuda
elif [ $# -eq 2 ]
 then
print "Verificando os locais:"
 print "${1}"
 print "${2}"
if [ ${1} == ${2} ]
 then
print "${1} e o mesmo local de destino (${2})"
 exit 1
elif [ ${1} != ${2} -a -r ${1} -a -w ${2} ]
 then
backup ${1} ${2}
else
print "${1} inacessivel ou ${2} nao pode ser escrito"
 exit 1
fi
else
ajuda
fi
exit 0</pre>
<p><strong>Exemplo</strong></p>
<p>No exemplo abaixo, serão sincronizadas as pastas "teste1" e "teste2", ambas presentes no mesmo diretório em que o script será executado (o que não é uma necessidade). Cada uma das pastas contém os arquivos "arquivo1" e "arquivo2", respectivamente. O objetivo é fazer com que a "pasta2" contenha os "arquivo1" e "arquivo2". Em qualquer caso, nenhum arquivos é apagado.</p>
<pre>./backup_rsync.ksh teste2 teste1
 Verificando os locais:
 teste2
 teste1
 sending incremental file list
 arquivo2
sent 127 bytes received 31 bytes 316.00 bytes/sec
 total size is 0 speedup is 0.00</pre>
<p><strong>Observações</strong></p>
<ul>
<li>Na primeira vez em que o script for utilizado, pode ser que leve um tempo maior; depois disso, o processo de sincronização é mais rápido;</li>
<li>Na linha 17 do script, a barra no final de ${origem} e ${destino} é necessária para que o conteúdo de ${origem} seja armazenado no primeiro nível de ${destino}, caso contrário a pasta ${origem} será criada dentro de ${destino}.</li>
</ul>
